from sqlalchemy.orm import joinedload

from models.profiles import Characteristic, PractitionerProfile
from storage.connection import db
from utils.log import logger

log = logger(__name__)


def bulk_deactivate_providers():  # type: ignore[no-untyped-def] # Function is missing a return type annotation
    users = [
        47039,
        135941,
        38110,
        157391,
        119196,
        27555,
        144672,
        22940,
        181975,
        76818,
        130338,
        21252,
        186880,
        6528,
        88,
        43494,
        23099,
        172117,
        38807,
        162430,
        47036,
        7397,
        90488,
        122381,
        143450,
        185142,
        90690,
        63065,
        167462,
        185669,
        142,
        171108,
        46986,
        117673,
        116576,
        76099,
        64117,
        14242,
        192,
        155299,
        135863,
        51087,
        246,
        48951,
        229,
        93,
        13104,
        101042,
        101466,
        53,
        184680,
        79490,
        11980,
        134836,
        19419,
        4238,
        14713,
        13828,
        79084,
        106,
        166467,
        58420,
        153,
        154866,
        114,
        30759,
        184,
        7609,
        89808,
        71161,
        171639,
        251,
        122310,
        134839,
        112,
        181,
        1665,
        97313,
        59394,
        313,
        134907,
        124912,
        243,
        12060,
        21274,
        58773,
        172,
        2141,
        127,
        147315,
        37927,
        135365,
        147936,
        29,
        176,
        70802,
        158892,
        211,
        23995,
        122,
        63074,
        76535,
        178,
        89246,
        233,
        805,
        79952,
        2826,
        7477,
        91115,
        33236,
        188,
        100,
        122354,
        75771,
        146228,
        88009,
        39116,
        170,
        1747,
        219,
        9657,
        94087,
        702,
        103,
        44499,
        97581,
        20,
        95,
        10074,
        13428,
        27,
        88484,
        108639,
        5438,
        96198,
        167588,
        224,
        108613,
        143130,
        136698,
        94864,
        80,
        102012,
        127150,
        81972,
        4096,
        145098,
        88029,
        120082,
        65946,
        6033,
        88014,
        116,
        88193,
        56497,
        180978,
        194723,
        116728,
        194689,
        195249,
        195581,
        182791,
        108618,
        91192,
        250,
        5178,
        134989,
        10279,
        92480,
        23,
        40,
        198,
        43252,
        3829,
        100930,
        102682,
        6647,
        106991,
        143224,
        130704,
        144688,
        13532,
        136552,
        135,
        868,
        167404,
        1723,
        18204,
        28917,
        4037,
        146861,
        171,
        117631,
        6259,
        110920,
        12887,
        125210,
        76134,
        43714,
        147326,
        178226,
        67,
        117574,
        116553,
        220,
        178213,
        117678,
        95373,
        5828,
        112772,
        4905,
        136862,
        122136,
        121074,
        12270,
        96089,
        14390,
        16069,
        29056,
        75687,
        125484,
        16042,
        32982,
        22267,
        139060,
        149598,
        20153,
        108965,
        149580,
        125578,
        125146,
        48166,
        154472,
        134913,
        93065,
        49827,
        19874,
        148587,
        4536,
        129329,
        117285,
        142229,
        125622,
        158805,
        120846,
        22017,
        92458,
        19905,
        125399,
        171663,
        31067,
        47994,
        124908,
        132895,
        92374,
        101433,
        86764,
        178825,
        182910,
        29485,
        585,
        119147,
        3742,
        147627,
        55369,
        511,
        162413,
        93840,
        7419,
        24336,
        74,
        37856,
        124911,
        163264,
        103389,
        14486,
        125096,
        38691,
        14323,
        75168,
        20305,
        21374,
        23525,
        37514,
        218,
        90318,
        185016,
        92027,
        62889,
        6565,
        70621,
        144833,
        109136,
        155271,
        88304,
        193833,
        190167,
        188859,
        184654,
        178412,
        86832,
        18421,
        157519,
        116700,
        832,
        96,
        37,
        626,
        130,
        177204,
        108627,
        121786,
        32836,
        17119,
        120867,
        121873,
        90441,
        860,
        80888,
        142065,
        70903,
        182894,
        183172,
        182211,
        167354,
        121498,
        205,
        116573,
        158997,
        82,
        5699,
        2101,
        178199,
        61354,
        118347,
        109625,
        300,
        99262,
        121773,
        7770,
        76848,
        92432,
        764,
        39181,
        98759,
        167395,
        111,
        107376,
        182829,
        90036,
        182792,
        23402,
        127090,
        70758,
        101172,
        87044,
        117766,
        21219,
        47066,
        81984,
        182,
        141,
        537,
        21303,
        223,
        5496,
        101797,
        101314,
        26390,
        34162,
        12071,
        13618,
        171266,
        151183,
        161635,
        104318,
        195785,
        88033,
        117730,
        181825,
        117630,
        67777,
        104571,
        179616,
        200275,
        1561,
        154473,
        12266,
        567,
        44338,
        185410,
        7576,
        92305,
        87026,
        25223,
        134838,
        128013,
        71341,
        190122,
        139700,
        48756,
        130713,
        141525,
        5208,
        182954,
        32590,
        24438,
        2539,
        188176,
        11832,
        11844,
        180200,
        187846,
        182895,
        14509,
        171244,
        87103,
        183450,
        192872,
        130593,
        139305,
        39961,
        147334,
        32534,
        21680,
        167355,
        58806,
        94124,
        48918,
        2904,
        100368,
        17122,
        178211,
        102367,
        89461,
        134883,
        162340,
        158792,
        182695,
        149612,
        59191,
        96299,
        86850,
        147951,
        147938,
        165014,
        1571,
        88166,
        137,
        13002,
        7601,
        128167,
        78516,
        159284,
        117259,
        75487,
        107,
        171130,
        136414,
        13965,
        10397,
        86168,
        19867,
        25213,
        1550,
        76309,
        47703,
        187746,
        125250,
        135007,
        133967,
        43119,
        136487,
        156065,
        122188,
        171138,
        149686,
        90553,
        2641,
        2945,
        162,
        92164,
        89151,
        143748,
        143887,
        120857,
        91270,
        20162,
        194651,
        15483,
        9996,
        59688,
        11825,
        21652,
        214,
        68266,
        171248,
        62454,
        87112,
        150435,
        172246,
        21646,
        163603,
        19808,
        21654,
        182673,
        31680,
        46379,
        10039,
        128241,
        63201,
        189237,
        132178,
        190330,
        44278,
        96914,
        14553,
        10542,
        21444,
        14394,
        184869,
        119790,
        19044,
        2268,
        159214,
        136477,
        157257,
        120886,
        190488,
        43111,
        11777,
        149581,
        130637,
        15572,
        163458,
        2559,
        184674,
        14363,
        100637,
        35427,
        121741,
        167356,
        155317,
        128614,
        90230,
        106069,
        913,
        113041,
        32541,
        149556,
        12957,
        4921,
        3275,
        162763,
        12197,
        16416,
        91422,
        13193,
        178200,
        190450,
        43466,
        2782,
        19378,
        95943,
        154,
        171206,
        29524,
        117257,
        166261,
        145,
        12798,
        167353,
        86811,
        901,
        178644,
        173483,
        86756,
        42393,
        143133,
        171263,
        89032,
        3209,
        110061,
        147629,
        130330,
        52743,
        46369,
        13822,
        70680,
        164307,
        12048,
        32785,
        144854,
        89193,
        86802,
        52478,
        2781,
        162226,
        13522,
        183077,
        23374,
        14508,
        14403,
        14513,
        20234,
        12044,
        14457,
        10728,
        2286,
        2431,
        17095,
        160186,
        186,
        12792,
        78,
        82089,
        59,
        82788,
        61184,
        52593,
        91,
        11781,
        5263,
        32552,
        2786,
        38779,
        61193,
        10006,
        254,
        106532,
        2408,
        892,
        92274,
        149564,
        191,
        147,
        1540,
        3049,
        76,
        170250,
        7401,
        2029,
        374,
        851,
        1851,
        793,
        105,
        221,
        228,
        895,
        2504,
        235,
        155,
        459,
        168224,
        5731,
        144,
        195,
        156640,
        258,
        165673,
        187,
        138,
        174544,
        23543,
        143,
        3544,
        94,
        5369,
        113,
        231,
        185007,
        121789,
        29142,
        157507,
        173,
        110,
        140781,
        208,
        1876,
        162992,
        125,
        209,
        1582,
        248,
        237,
        239,
        166401,
        86777,
        1453,
        596,
        259,
        227,
        131,
        160,
        215,
        697,
        212,
        102696,
        121,
        1573,
        167,
        519,
        629,
        1076,
        151,
        183,
        169095,
        64630,
        184683,
        1488,
        162799,
        88204,
        5680,
        159168,
        45843,
        68,
        433,
        122792,
        18,
        103892,
        164694,
        13189,
        108419,
        149651,
        41,
        206,
        145686,
        13516,
        6113,
        182963,
        99,
        207,
        406,
        89102,
        66507,
        245,
        9997,
        97,
        16725,
        12821,
        19,
        190000,
        143151,
        187784,
        101,
        13195,
        141946,
        1519,
        101184,
        99990,
        164,
        167584,
        178575,
        184784,
        146812,
        159720,
        109,
        183792,
        794,
        196975,
        154614,
        153896,
        1480,
        13508,
        167699,
        527,
        48074,
        136054,
        159197,
        171268,
        2193,
        10477,
        10440,
        82948,
        217,
        151677,
        159878,
        13506,
        118,
        152021,
        62722,
        151060,
        54,
        85,
        10561,
        121312,
        151074,
        180971,
        1017,
        2204,
        965,
        125152,
        1580,
        135343,
        125411,
        144154,
        151476,
        125567,
        165465,
        149558,
        37834,
        40860,
        99277,
        37825,
        182747,
        75353,
        187788,
        96683,
        58902,
        160954,
        182769,
    ]

    deactivated_characteristic = Characteristic.query.filter(
        (Characteristic.id == 34)
        and (Characteristic.name == "Deactivated (Unsigned Contract)")
    ).first()
    if deactivated_characteristic is None:
        log.warn("Cannot find correct deactivation characteristic code")
    else:
        for user_id in users:
            p = PractitionerProfile.query.options(
                joinedload(PractitionerProfile.user)
            ).get(user_id)
            if p is None:
                log.warn("Could not find practitioner by user_id.", user_id=user_id)
                continue
            u = p.user
            u.active = False
            p.active = False
            p.messaging_enabled = False
            p.show_when_unavailable = False
            p.characteristics.append(deactivated_characteristic)
            db.session.commit()
            log.info("Deactivated practitioner.", user_id=user_id)
